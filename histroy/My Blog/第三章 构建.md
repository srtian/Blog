
# 构建


### 3.1、构建功能解决的问题
构建，又可以称之为编译。在前端工程体系中的角色是将源代码转化为宿主浏览器可执行的代码，其核心是资源管理。对于前端基础的资源，在构建构成中需要做以下一些事情：

```
JS -> ECMAScript转译
LESS/SASS -> CSS
Jade/EJS -> HTML
```

除了语言本身的资源，前端资源的构建还需要考虑web应用的性能因素。比如开发阶段使用模块化开发，在上线前，就需要对这些资源进行统一的处理：

- 依赖打包: 分析文件依赖关系，将同步依赖文件打包，减少HTTP请求
- 资源嵌入: 比如将10kb的图片编译为base64格式嵌入文档，减少一次 HTTP 请求
- 文件压缩: 减少文件体积，缩短请求时间
- hash指纹: 通过给文件名加入hash指纹，以应对浏览器缓存策略

HTML文件与其他资源是引用与被引用的关系，被引用的资源进过构建后通常有以下改动：

- 域名/路径改变
- 文件名改变：加上hash指纹

综上，构建所解决的问题可归纳为三类：

- 面向语言
- 面向优化
- 面向部署


### 3.5 模块化和组件化

组件化和模块化是两个不同的概念。区别体现在颗粒度层面。

- 模块是一个白盒， 侧重对属性的封装，重心在设计以及开发阶段，不关注运行时的逻辑。
- 组件是一个可以独立部署的软件单元，面向运行时，侧重产品的功能性，组件时一个黑盒，内部逻辑是不可见的。

模块可以理解为螺丝钉，而组件是轮胎。


### 3.5.2 模块化和工程化
模块化属于架构层面的概念。前端工程化和模块化可以抽象为组装车间与零件。前端工程体系中，构建系统最重要的功能之一就是支持模块化规范，并能将散列的模块构建为利于部署的整合文件。

![image.png](https://cdn.nlark.com/yuque/0/2020/png/296173/1586490138747-5a6139e3-279c-48e3-bdf8-8695ccc40062.png#align=left&display=inline&height=451&name=image.png&originHeight=902&originWidth=1238&size=375614&status=done&style=none&width=619)


### 模块化的价值

- 避免命名冲突
- 便于依赖管理
- 利于性能优化：一是模块的按需加载，二是散列模块的合并打包，减少HTTP请求 三是细粒度的模块划分搭配动态加载，让Web应用程序的解析更顺畅
- 提高可维护性：由于解决1， 2 两个问题
- 利于代码复用


### 模块发展史

1. CommonJS，为静态模块规范，用于Node.js。
   1. CommonJS无法处理 JavaScript 以外的资源 。
   2. CommonJS所有模块均是同步阻塞式加载，无法实现按需异步加载
2. AMD/CMD

与CommonJS的区别：

- 可以处理除JS以外的资源
- 源码无需编译即可在浏览器环境运行
- 支持异步加载，并行加载
- 插件系统

以上三者共同的缺点：

- 应用场景单一，无法跨运行环境
- 构建不统一
- 不同规范的模块无法混用，可复用性不高
- 未来不可期
3. ES6 Module


### 增量更新和缓存
合理利于缓存是Web性能优化的必要手段，前端的缓存手段主要针对客户端浏览器缓存策略，客户端缓存主要有以下两种：

- 本地缓存：loaclStorage, SessionStorage
- HTTP缓存策略：强缓存和协商缓存


### HTTP 缓存策略
分为强缓存和协商缓存<br />强缓存是根据过期时间来判断使用本地缓存还是请求新资源。协商缓存则会每次都发起请求，经过服务器不对后决定使用本地缓存还是新资源。<br />具体的HTTP缓存知识我在之前也有所学习：[https://www.yuque.com/srtian/fe/hkwd6d](https://www.yuque.com/srtian/fe/hkwd6d)

### 资源定位
Web 项目中的资源定位指的是存在引用关系的资源之间被引用方地址的改动都会被及时同步到引用方。

资源定位是构建系统面向部署的必要功能，webpack使用反向注入的方式实现静态资源的定位和替换。这种模式适用于没有历史包袱、模块化架构合理的项目，然 而在实际开发中的部分特殊场景下需要开发者对静态资源的引用顺序、位置、类型 有绝对的掌控权，注入模式并不适用。 webpack提供了丰富的扩展剧，为解决复杂 的资源定位提供了强有力的技术支持。

